
<img width="761" alt="스크린샷 2022-08-06 오후 11 02 05" src="https://user-images.githubusercontent.com/38747893/183252188-df22cb15-2cbb-4383-891f-8230f987d73b.png">

우선 url에 val=1이 눈에 띈다

<img width="625" alt="스크린샷 2022-08-06 오후 11 05 50" src="https://user-images.githubusercontent.com/38747893/183252314-857b06e2-0802-45ac-81be-b66ca5cf27be.png">

val=숫자 값을 다른것으로 변경해 보았을때 
<br/>
2는 Access Denied! 라고 출력되고 다른 3 이상의 숫자 부터
query error 라고 출력된다 
<br/><br/>
~~~php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 7</title>
</head>
<body>
<?php

$go=$_GET['val'];
if(!$go) { echo("<meta http-equiv=refresh content=0;url=index.php?val=1>"); }
echo("<html><head><title>admin page</title></head><body bgcolor='black'><font size=2 color=gray><b><h3>Admin page</h3></b><p>");
if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");


$db = dbconnect();
$rand=rand(1,5);
if($rand==1){
  $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
}
if($rand==2){
  $result=mysqli_query($db,"select lv from chall7 where lv=(($go))") or die("nice try!");
}
if($rand==3){
  $result=mysqli_query($db,"select lv from chall7 where lv=((($go)))") or die("nice try!");
}
if($rand==4){
  $result=mysqli_query($db,"select lv from chall7 where lv=(((($go))))") or die("nice try!");
}
if($rand==5){
  $result=mysqli_query($db,"select lv from chall7 where lv=((((($go)))))") or die("nice try!");
}
$data=mysqli_fetch_array($result);
if(!$data[0]) { echo("query error"); exit(); }
if($data[0]==1){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
}
elseif($data[0]==2){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Hello admin')\"><p>");
  solve(7);
}
?>
<a href=./?view_source=1>view-source</a>
</body>
</html>
~~~
<br/> <br/>
이제 다른 정보가 없으므로 소스코드를 해석해본다
<br/> <br/>
제일 먼저 보이는것은 $data[0]==2 일때 solve(7)을 실행하므로 7번의 목표인것 같다.


1. val값을 $_GET 방식으로 $go 에 저장
2. $go값 즉 val이 없으면 val=1 로 초기화
3. preg_match 함수 -> val 값에 2, -, +, from, _, =, \, \s 등이 있는지 검사하는 함수 만약 있다면 Access Denied! 출력 
<br/>(val=2에서 Access Denied!가 출력된 이유)
----
4. rand 함수로 1~5 까지 랜덤으로 나온 숫자에 따라 DB에 select lv from chall7 where lv=($go) 명령을 전송 이때 ($go) 괄호의 숫자
5. 





> ### preg_match
> 1. 첫 번째 인수 : 정규식 표현 작성.
> 2. 두 번째 인수 : 검색 대상 문자열.
> 3. 세 번째 인수 : 배열 변수 반환. 패턴 매치에서 매칭된 값을 배열로 저장.
> <br/>
> 반환값 : 매칭에 성공하면 1, 실패하면 0이 반환


